<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Anniinan portfolio</title>
    <link href="config.yml" type="text/yaml" rel="cms-config-url" />
    <script>
        // Emergency Fallback: If Decap CMS doesn't react to the message, we can help it
        window.addEventListener("message", (event) => {
            if (typeof event.data === 'string' && event.data.startsWith('authorization:github:success:')) {
                console.log('Admin: OAuth message received. If the page doesn\'t refresh in 3 seconds, logging in manually...');

                const jsonStr = event.data.replace('authorization:github:success:', '');
                try {
                    const data = JSON.parse(jsonStr);
                    // This is the fallback: it forces the session into localStorage if CMS fails
                    setTimeout(() => {
                        if (!localStorage.getItem('decap-cms-user')) {
                            console.log('Admin: Manual session injection triggered.');
                            localStorage.setItem('decap-cms-user', JSON.stringify({
                                name: 'Anniinas',
                                token: data.token,
                                provider: 'github'
                            }));
                            window.location.reload();
                        }
                    }, 3000);
                } catch (e) {
                    console.error('Admin: Failed to parse OAuth data', e);
                }
            }
        }, false);
    </script>
</head>

<body>
    <script src="https://unpkg.com/decap-cms@^3.10.0/dist/decap-cms.js"></script>
</body>

</html>