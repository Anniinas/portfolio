---
interface Props {
	title: string;
	url: string;
}

const { title, url } = Astro.props;
---

	<button id="mastodon-share-btn" class="share-link mastodon" data-title={title} data-url={url}>
		<svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
			<path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.303 7.929.151 10.83.151 12.89c0 .64 0 1.258.01 1.85.064 3.737.522 7.425 3.328 8.441 1.777.644 3.51.724 5.31.628 2.016-.107 3.82-.544 3.82-.544l-.04-2.145s-1.666.522-3.523.475c-1.928-.047-3.978-.508-4.212-3.23a49.197 49.197 0 0 1-.033-2.33s2.105.534 5.222.637c2.643.087 5.147-.384 7.636-.93 2.083-.457 3.57-2.625 3.812-4.997a33.597 33.597 0 0 0 .048-4.373zM18.84 13.447h-2.19v-5.63l-.04-.002-2.19 5.63h-2.19l-2.19-5.63-.04.002v5.63H8.38V7.034h3.33l1.11 2.858 1.11-2.858h3.33v6.413z"/>
		</svg>
		Mastodon
	</button>

<div id="mastodon-modal" class="modal">
	<div class="modal-content">
		<h3>Jaa Mastodonissa</h3>
		<p>Anna palvelimesi osoite (esim. mastodon.social):</p>
		<input type="text" id="mastodon-instance" placeholder="mastodon.social" />
		<div class="modal-actions">
			<button id="cancel-share">Peruuta</button>
			<button id="confirm-share">Jatka</button>
		</div>
	</div>
</div>

<script>
	const btn = document.getElementById('mastodon-share-btn');
	const modal = document.getElementById('mastodon-modal');
	const cancelBtn = document.getElementById('cancel-share');
	const confirmBtn = document.getElementById('confirm-share');
	const instanceInput = document.getElementById('mastodon-instance') as HTMLInputElement;

	btn?.addEventListener('click', () => {
		const savedInstance = localStorage.getItem('mastodon-instance');
		if (savedInstance) {
			shareToMastodon(savedInstance);
		} else {
			modal?.classList.add('show');
		}
	});

	cancelBtn?.addEventListener('click', () => {
		modal?.classList.remove('show');
	});

	confirmBtn?.addEventListener('click', () => {
		const instance = instanceInput.value.trim();
		if (instance) {
			localStorage.setItem('mastodon-instance', instance);
			shareToMastodon(instance);
			modal?.classList.remove('show');
		}
	});

	function shareToMastodon(instance: string) {
		const title = btn?.getAttribute('data-title');
		const url = btn?.getAttribute('data-url');
		const shareUrl = `https://${instance}/share?text=${encodeURIComponent(title + ' ' + url)}`;
		window.open(shareUrl, '_blank');
	}
</script>

<style>
	.share-link {
		display: inline-flex;
		align-items: center;
		gap: 0.3rem;
		background: transparent;
		color: var(--muted-color);
		border: none;
		padding: 0;
		cursor: pointer;
		font-family: 'Inter', sans-serif;
		font-weight: 400;
		font-size: 0.8rem;
		line-height: inherit;
		transition: color 0.2s;
	}

	.share-link svg {
		vertical-align: middle;
	}

	.share-link.mastodon:hover {
		color: #6364ff;
	}

	.modal {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0,0,0,0.8);
		z-index: 1000;
		justify-content: center;
		align-items: center;
	}

	.modal.show {
		display: flex;
	}

	.modal-content {
		background: #1a1a1a;
		padding: 2rem;
		border-radius: 8px;
		max-width: 400px;
		width: 90%;
		border: 1px solid #333;
	}

	.modal-content h3 {
		margin-top: 0;
	}

	input {
		width: 100%;
		padding: 0.8rem;
		margin: 1rem 0;
		background: #0d0d0d;
		border: 1px solid #333;
		color: white;
		border-radius: 4px;
	}

	.modal-actions {
		display: flex;
		justify-content: flex-end;
		gap: 1rem;
	}

	.modal-actions button {
		padding: 0.5rem 1rem;
		border-radius: 4px;
		cursor: pointer;
	}

	#cancel-share {
		background: transparent;
		color: #888;
		border: 1px solid #333;
	}

	#confirm-share {
		background: var(--accent-color);
		color: white;
		border: none;
	}
</style>
